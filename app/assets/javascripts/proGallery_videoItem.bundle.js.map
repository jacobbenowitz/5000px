{"version":3,"file":"proGallery_videoItem.bundle.js","mappings":";;;;;;;;;AAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;;;AC1B4C;AAClB;AACsC;AACN;AACG;AAC3B;AAClC;AACA,IAAI,oIAAS;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,cAAc,uDAAM,IAAI,mEAAkB;AAC1C,YAAY,4MACgE;AAC5E,gBAAgB,mEAAkB;AAClC,iCAAiC,yBAAyB;AAC1D;AACA,aAAa;AACb;AACA;AACA;AACA,UAAU,uDAAM,IAAI,6DAAY;AAChC;AACA;AACA,YAAY,mNACiE;AAC7E,gBAAgB,6DAAY,KAAK;AACjC,iCAAiC,yBAAyB;AAC1D;AACA,aAAa;AACb;AACA;AACA;AACA,UAAU,uDAAM,IAAI,2DAAU;AAC9B;AACA,YAAY,iMAA+D;AAC3E,gBAAgB,2DAAU;AAC1B,iCAAiC,uBAAuB;AACxD;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qCAAqC,6DAAW;AAChD;AACA;AACA,oCAAoC,6DAAW;AAC/C;AACA;AACA;AACA,4BAA4B,iBAAiB;AAC7C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,gCAAgC;AAChC;AACA;AACA;AACA;AACA;AACA,wBAAwB,8EAA6B;AACrD;AACA;AACA;AACA,oBAAoB,iEAAe;AACnC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,cAAc,uDAAM;AACpB,YAAY,mEAAkB;AAC9B;AACA;AACA;AACA,4BAA4B,mEAAkB;AAC9C;AACA;AACA;AACA;AACA;AACA;AACA,mCAAmC,wEAA+B,EAAE,sEAA6B;AACjG;AACA;AACA;AACA;AACA;AACA,mBAAmB,gDAAQ;AAC3B;AACA;AACA,YAAY,yEAA4B;AACxC,qDAAqD,uEAA8B,EAAE,yEAAgC;AACrH;AACA,gBAAgB,0DAAmB,kBAAkB,yPAAyP,gCAAgC;AAC9U,iCAAiC,gBAAgB;AACjD,mDAAmD,0EAAiC;AACpF,aAAa;AACb,iCAAiC,gBAAgB;AACjD,aAAa;AACb,mDAAmD,0EAAiC,EAAE,oIAAQ,CAAC,oIAAQ,GAAG,kBAAkB,eAAe;AAC3I,aAAa;AACb;AACA,qCAAqC,kBAAkB;AACvD;AACA,aAAa;AACb,mDAAmD,2EAAkC;AACrF,iCAAiC,eAAe;AAChD,aAAa;AACb;AACA;AACA;AACA,iCAAiC,aAAa;AAC9C,aAAa;AACb;AACA;AACA;AACA;AACA,iBAAiB;AACjB,aAAa,iCAAiC;AAC9C;AACA;AACA;AACA,mCAAmC,gEAAe;AAClD,gBAAgB,+EAA8B;AAC9C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,kCAAkC,oIAAQ,GAAG;AAC7C,YAAY,6EAA2B;AACvC;AACA,aAAa,yEAA4B;AACzC;AACA;AACA;AACA,gFAAgF,wEAA+B,EAAE,yEAAgC;AACjJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa,gEAAc;AAC3B;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qBAAqB,0DAAmB,UAAU,+JAA+J;AACjN;AACA;AACA,gBAAgB,0DAAmB,UAAU,mDAAmD;AAChG;AACA,YAAY,yEAA4B;AACxC;AACA;AACA;AACA;AACA,CAAC,CAAC,+DAAgB;AAClB,iEAAe,SAAS,EAAC;AACzB","sources":["webpack://my5000px/./node_modules/pro-gallery/dist/esm/components/item/videos/getStyle.js","webpack://my5000px/./node_modules/pro-gallery/dist/esm/components/item/videos/videoItem.js"],"sourcesContent":["\"use strict\";\nmodule.exports = getStyle;\nfunction getStyle(isCrop, isWiderThenContainer) {\n    var CALC = 'calc(100% + 1px)';\n    return isCrop ? getCrop() : getNonCrop();\n    function getCrop() {\n        return {\n            height: isWiderThenContainer ? CALC : 'auto',\n            width: isWiderThenContainer ? 'auto' : CALC,\n            position: 'absolute',\n            margin: 'auto',\n            minHeight: '100%',\n            minWidth: '100%',\n            left: '-100%',\n            right: '-100%',\n            top: '-100%',\n            bottom: '-100%',\n        };\n    }\n    function getNonCrop() {\n        return {\n            width: isWiderThenContainer ? CALC : 'auto',\n            height: isWiderThenContainer ? '100%' : CALC,\n        };\n    }\n}\n//# sourceMappingURL=getStyle.js.map","import { __assign, __extends } from \"tslib\";\nimport React from 'react';\nimport { GALLERY_CONSTS, window, utils } from 'pro-gallery-lib';\nimport { GalleryComponent } from '../../galleryComponent';\nimport { shouldCreateVideoPlaceholder } from '../itemHelper';\nimport getStyle from './getStyle';\nvar VideoItem = /** @class */ (function (_super) {\n    __extends(VideoItem, _super);\n    function VideoItem(props) {\n        var _this = _super.call(this, props) || this;\n        _this.pause = _this.pause.bind(_this);\n        _this.play = _this.play.bind(_this);\n        _this.playVideoIfNeeded = _this.playVideoIfNeeded.bind(_this);\n        _this.state = {\n            playedOnce: false,\n            loadVideo: props.loadVideo || props.playing,\n            playing: false,\n            reactPlayerLoaded: false,\n            vimeoPlayerLoaded: false,\n            hlsPlayerLoaded: false,\n        };\n        return _this;\n    }\n    VideoItem.prototype.componentDidMount = function () {\n        this.dynamiclyImportVideoPlayers();\n    };\n    VideoItem.prototype.dynamiclyImportVideoPlayers = function () {\n        var _this = this;\n        if (!(window && window.ReactPlayer)) {\n            import(\n            /* webpackChunkName: \"proGallery_reactPlayer\" */ 'react-player').then(function (ReactPlayer) {\n                window.ReactPlayer = ReactPlayer.default;\n                _this.setState({ reactPlayerLoaded: true });\n                _this.playVideoIfNeeded();\n            });\n        }\n        if (\n        //Vimeo player must be loaded by us, problem with requireJS\n        !(window && window.Vimeo) &&\n            this.props.videoUrl &&\n            this.props.videoUrl.includes('vimeo.com')) {\n            import(\n            /* webpackChunkName: \"proGallery_vimeoPlayer\" */ '@vimeo/player').then(function (Player) {\n                window.Vimeo = { Player: Player.default };\n                _this.setState({ vimeoPlayerLoaded: true });\n                _this.playVideoIfNeeded();\n            });\n        }\n        if (\n        //Hls player must be loaded by us, problem with requireJS\n        !(window && window.Hls) &&\n            this.isHLSVideo()) {\n            import(/* webpackChunkName: \"proGallery_HlsPlayer\" */ 'hls.js').then(function (Player) {\n                window.Hls = Player.default;\n                _this.setState({ hlsPlayerLoaded: true });\n                _this.playVideoIfNeeded();\n            });\n        }\n    };\n    VideoItem.prototype.isHLSVideo = function () {\n        return (this.props.videoUrl &&\n            (this.props.videoUrl.includes('/hls') ||\n                this.props.videoUrl.includes('.m3u8')));\n    };\n    VideoItem.prototype.shouldUseHlsPlayer = function () {\n        return this.isHLSVideo() && !utils.isiOS();\n    };\n    VideoItem.prototype.shouldForceVideoForHLS = function () {\n        return this.isHLSVideo() && utils.isiOS();\n    };\n    VideoItem.prototype.UNSAFE_componentWillReceiveProps = function (nextProps) {\n        if (nextProps.playing || nextProps.firstUserInteractionExecuted) {\n            this.setState({ loadVideo: true });\n        }\n        this.playVideoIfNeeded(nextProps);\n    };\n    VideoItem.prototype.componentDidUpdate = function (prevProps) {\n        if (prevProps.currentIdx !== this.props.currentIdx) {\n            this.fixIFrameTabIndexIfNeeded();\n        }\n        if (prevProps.type === 'image' && this.props.type === 'video') {\n            this.dynamiclyImportVideoPlayers();\n        }\n        this.playVideoIfNeeded();\n    };\n    VideoItem.prototype.play = function () {\n        this.props.playVideo(this.props.idx);\n    };\n    VideoItem.prototype.pause = function () {\n        this.props.pauseVideo();\n    };\n    VideoItem.prototype.playVideoIfNeeded = function (props) {\n        if (props === void 0) { props = this.props; }\n        try {\n            var playingVideoIdx = props.playingVideoIdx;\n            if (playingVideoIdx === this.props.idx && !this.isPlaying) {\n                this.videoElement =\n                    this.videoElement ||\n                        window.document.querySelector(\"#video-\" + this.props.id + \" video\");\n                if (this.videoElement) {\n                    this.isPlaying = true;\n                    this.videoElement.play();\n                    utils.isVerbose() &&\n                        console.log('[VIDEO] Playing video #' + this.props.idx, this.videoElement);\n                }\n            }\n        }\n        catch (e) {\n            console.error('[VIDEO] Could not play video #' + this.props.idx, this.videoElement, e);\n        }\n    };\n    //-----------------------------------------| UTILS |--------------------------------------------//\n    VideoItem.prototype.createPlayerElement = function () {\n        var _this = this;\n        //video dimensions are for videos in grid fill - placing the video with negative margins to crop into a square\n        if (!(window &&\n            window.ReactPlayer &&\n            (this.state.loadVideo || this.props.playing))) {\n            return null;\n        }\n        var PlayerElement = window.ReactPlayer;\n        var isWiderThenContainer = this.props.style.ratio >= this.props.cubeRatio;\n        // adding 1 pixel to compensate for the difference we have sometimes from layouter in grid fill\n        var isCrop = this.props.styleParams.cubeImages &&\n            this.props.styleParams.cubeType === 'fill';\n        var url = this.props.videoUrl\n            ? this.props.videoUrl\n            : this.props.createUrl(GALLERY_CONSTS.urlSizes.RESIZED, GALLERY_CONSTS.urlTypes.VIDEO);\n        var attributes = {\n            controlsList: 'nodownload',\n            disablepictureinpicture: 'true',\n            muted: !this.props.styleParams.videoSound,\n            preload: 'metadata',\n            style: getStyle(isCrop, isWiderThenContainer),\n            type: 'video/mp4',\n        };\n        if (shouldCreateVideoPlaceholder(this.props.styleParams)) {\n            attributes.poster = this.props.createUrl(GALLERY_CONSTS.urlSizes.SCALED, GALLERY_CONSTS.urlTypes.HIGH_RES);\n        }\n        return (React.createElement(PlayerElement, { className: 'gallery-item-visible video gallery-item', id: \"video-\" + this.props.id, width: \"100%\", height: \"100%\", url: url, alt: this.props.alt ? this.props.alt : 'untitled video', loop: !!this.props.styleParams.videoLoop, ref: function (player) { return (_this.video = player); }, volume: this.props.styleParams.videoSound ? 0.8 : 0, playing: this.props.playing, onEnded: function () {\n                _this.setState({ playing: false });\n                _this.props.actions.eventsListener(GALLERY_CONSTS.events.VIDEO_ENDED, _this.props);\n            }, onPause: function () {\n                _this.setState({ playing: false });\n            }, onError: function (e) {\n                _this.props.actions.eventsListener(GALLERY_CONSTS.events.VIDEO_ERROR, __assign(__assign({}, _this.props), { videoError: e }));\n            }, playbackRate: Number(this.props.styleParams.videoSpeed) || 1, onStart: function () {\n                if (!_this.state.playedOnce) {\n                    _this.setState({ playedOnce: true });\n                }\n            }, onPlay: function () {\n                _this.props.actions.eventsListener(GALLERY_CONSTS.events.VIDEO_PLAYED, _this.props);\n                _this.setState({ playing: true });\n            }, onReady: function () {\n                _this.playVideoIfNeeded();\n                _this.fixIFrameTabIndexIfNeeded();\n                _this.props.actions.setItemLoaded();\n                _this.setState({ ready: true });\n            }, controls: this.props.styleParams.showVideoControls, config: {\n                file: {\n                    attributes: attributes,\n                    forceHLS: this.shouldUseHlsPlayer(),\n                    forceVideo: this.shouldForceVideoForHLS(),\n                },\n            }, key: 'video-' + this.props.id }));\n    };\n    VideoItem.prototype.fixIFrameTabIndexIfNeeded = function () {\n        if (this.props.isExternalVideo) {\n            var videoGalleryItem = window.document &&\n                window.document.getElementById(\"video-\" + this.props.id);\n            var videoIFrames = videoGalleryItem && videoGalleryItem.getElementsByTagName('iframe');\n            var videoIFrame = videoIFrames && videoIFrames[0];\n            if (videoIFrame) {\n                if (this.props.currentIdx === this.props.idx) {\n                    videoIFrame.setAttribute('tabIndex', '0');\n                }\n                else {\n                    videoIFrame.setAttribute('tabIndex', '-1');\n                }\n            }\n        }\n    };\n    VideoItem.prototype.getVideoContainerStyles = function () {\n        var videoContainerStyle = __assign({}, this.props.imageDimensions);\n        if (utils.deviceHasMemoryIssues() ||\n            this.state.ready ||\n            !shouldCreateVideoPlaceholder(this.props.styleParams)) {\n            videoContainerStyle.backgroundColor = 'black';\n        }\n        else {\n            videoContainerStyle.backgroundImage = \"url(\" + this.props.createUrl(GALLERY_CONSTS.urlSizes.RESIZED, GALLERY_CONSTS.urlTypes.HIGH_RES) + \")\";\n        }\n        return videoContainerStyle;\n    };\n    //-----------------------------------------| RENDER |--------------------------------------------//\n    VideoItem.prototype.render = function () {\n        var _a = this.props, videoPlaceholder = _a.videoPlaceholder, hover = _a.hover;\n        var baseClassName = 'gallery-item-content gallery-item-visible gallery-item-preloaded gallery-item-video gallery-item video-item' +\n            (utils.isiPhone() ? ' ios' : '');\n        if (this.state.playing) {\n            baseClassName += ' playing';\n        }\n        if (this.state.playedOnce && this.state.ready) {\n            baseClassName += ' playedOnce';\n        }\n        // eslint-disable-next-line no-unused-vars\n        var video = (React.createElement(\"div\", { className: baseClassName, \"data-hook\": \"video_container-video-player-element\", key: 'video_container-' + this.props.id, style: this.getVideoContainerStyles() },\n            this.createPlayerElement(),\n            this.props.videoPlayButton));\n        return (React.createElement(\"div\", { key: 'video-and-hover-container' + this.props.idx },\n            video,\n            shouldCreateVideoPlaceholder(this.props.styleParams) &&\n                videoPlaceholder,\n            hover));\n    };\n    return VideoItem;\n}(GalleryComponent));\nexport default VideoItem;\n//# sourceMappingURL=videoItem.js.map"],"names":[],"sourceRoot":""}